# TCP

##TCP状态转移

![26](C:\Users\18181\Desktop\doc\repo\img\26.png)

## 三次握手

  1.客户端发起第一次握手(SYN=1, seq=x)

  2.服务器端发起第二次握手(SYN=1, seq=y, ACKnum=x+1)

  3.客户端发起第三次握手(ACKnum=y+1)

## 四次挥手

1. 想要拆除连接的一方A发送FIN报文，自身进入到FIN_WAIT_1状态；
2. 被拆除连接的一方B接收到FIN报文，发ACK，自身进入到CLOSE_WAIT状态；
3. A收到ACK，进入FIN_WAIT_2状态;
4. B发送FIN，自身进入LAST_ACK状态；
5. A收到FIN，发送ACK，自身进入TIME_WAIT状态；
6. B收到ACK报文，B上的这个socket关闭，端口释放；
7. A等待2MSL后socket关闭，释放端口。

为什么四次挥手？

由于TCP连接是全双工的，因此每个方向都必须单独进行关闭。这原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。

## 2MSL等待状态

TIME_WAIT状态也称为2 MSL等待状态。每个具体 TCP实现必须选择一个报文段最大生存时间MSL（Maximum Segment Lifetime）。它是任何报文段被丢弃前在网络内的最长时间。 我们知道这个时间是有限的，因为TCP报文段以IP数据报在网络内传输，而IP数据报则有限制 其生存时间的TTL字段。

```
TIME_WAIT状态的作用主要有两个：

1.避免拆链报文在链路中丢失造成连接关闭异常：在第6步，B没有收到ACK报文的时候会认为A没有收到FIN包，进而会重传第4步的FIN，如果这个时候没有TIME_WAIT状态，A侧socket已经关闭，A会针对B发送的FIN包响应RST，有可能导致B连接异常。
2.避免乱序到来的业务报文在新生成的socket连接中引发混乱：假设在拆链前有TCP报文由于中间网络传输原因导致在第7步完成之后才到达，如果没有TIME_WAIT状态而A和B又使用同样的4元组新建了一个新的socket，那么迷路的数据包就会进入到新的socket中进行处理，可能导致业务异常。
```



 T C P连接在2 M S L等待期间，定义这个连接的插口 （客户的I P地址和端口号，服务器的 I P地址和端口号）不能再被使用。这个连接只能在 2 M S L 结束后才能再被使用。

## 和UDP的区别

```
1.TCP是面向连接的传输协议，传输数据之前必须先建立好连接。UDP是属于无连接的传输协议
2.TCP是点对点的两点之间的服务，一条TCP连接只能有两个端点,UDP支持一对一、一对多、多对一、多对多的交互通信
3.TCP是可靠的传输协议，进行的是可靠交付，即无差错、不丢失、不重复、按序到达等.UDP是不可靠的传输协议，只是尽最大努力交付，不能保证可靠交付
4.TCP有拥塞控制和流量控制保证数据传输的安全性。UDP没有拥塞控制，当网络拥塞时不会影响源主机的发送效率
5.TCP首部开销大，因为首部就占了20个字节。UDP首部开销相对小一点，只占了8个字节。 （eg: UDP的8个字节分布在：源端口、目的端口、数据长度、校验和）
```

## 流量控制



## 拥塞控制



# DNS

DNS 的全称是 Domain Name System 或者 Domain Name Service，它主要的作用就是将人们所熟悉的网址 (域名) “翻译”成电脑可以理解的 IP 地址，这个过程叫做 DNS 域名解析。

## 输入url后的解析过程

```
1.根据域名，进行DNS域名解析；
2.拿到解析的IP地址，建立TCP连接；
3.向IP地址，发送HTTP请求；
4.服务器处理请求；
5.返回响应结果；
6.关闭TCP连接；
7.浏览器解析HTML；
8.浏览器布局渲染；
```



# 杂项



##DHCP-动态主机设置协议

https://www.cnblogs.com/easonscx/p/10724742.html



##网络通信元组

```
四元组：源IP地址，源端口，目的IP地址，目的端口
五元组：源IP地址，源端口，目的IP地址，目的端口和传输层协议
七元组：源IP地址，源端口，目的IP地址，目的端口，传输层协议，服务类型，接口索引
```

# 
